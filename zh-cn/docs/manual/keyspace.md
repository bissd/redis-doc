---
title: "键空间"
linkTitle: "键空间"
weight: 1
description: >
    在Redis中管理键：键过期、扫描、修改和查询键空间。
aliases:
  - /docs/manual/the-redis-keyspace    
---

Redis键是二进制安全的；这意味着您可以使用任何二进制序列作为键，从类似"foo"的字符串到JPEG文件的内容。
空字符串也是一个有效的键。

关于密钥的其他几个规则：

非常长的键并不是一个好主意。例如，一个1024字节的键不仅在内存方面是一个坏主意，而且因为在数据集中查找键可能需要多次昂贵的键比较，所以也不是一个好主意。即使任务是匹配一个大值的存在，使用哈希（例如SHA1）也是一个更好的主意，特别是从内存和带宽的角度来看。

非常短的键通常不是一个好主意。如果你可以写"用户:1000:跟随者"，那么没有必要写"u1000flw"。后者更可读，而且与键对象本身和值对象使用的空间相比，添加的空间是微不足道的。虽然短键显然会消耗更少的内存，但你的任务是找到合适的平衡点。

尽量遵守一个模式。例如，"对象类型:id"是一个好主意，如"user:1000"。点号或破折号经常用于多字字段，如"comment:4321:reply.to"或"comment:4321:reply-to"。

允许的最大键大小为512MB。

## 更改和查询键空间

有一些命令没有针对特定类型进行定义，但在与键空间互动时很有用，因此可以与任何类型的键一起使用。

例如，`EXISTS` 命令返回值为 1 或 0，表示数据库中是否存在给定的键；而 `DEL` 命令会删除键和其对应的值，无论值是什么。

    > set mykey hello
    OK
    > exists mykey
    (integer) 1
    > del mykey
    (integer) 1
    > exists mykey
    (integer) 0

从例子中你也可以看到`DEL`返回1或0取决于键是否被删除(存在)或没有这样的键。名字)。

有许多与键空间相关的命令，但以上两个命令以及`TYPE`命令是最重要的，它返回指定键存储的值的类型：

    > set mykey x
    OK
    > type mykey
    string
    > del mykey
    (integer) 1
    > type mykey
    none

## 密钥过期

在继续之前，我们应该看一下一个重要的Redis功能，它可以在存储的值的类型无关的情况下工作：键的过期。键的过期允许您为键设置超时，也称为"生存时间"或"TTL"。当生存时间到期时，键会被自动销毁。

关于密钥过期的一些重要说明：

* 它们可以使用秒或毫秒精度来设置。
* 但是到期时间的分辨率始终为1毫秒。
* 关于到期时间的信息会被复制并持久化到磁盘上，在Redis服务器停止时时间依然会推移（这意味着Redis保存了键将过期的日期）。

使用`EXPIRE`命令来设置键的过期时间：

    > set key some-value
    OK
    > expire key 5
    (integer) 1
    > get key (immediately)
    "some-value"
    > get key (after some time)
    (nil)

关键字在两次`GET`调用之间消失了，因为第二次调用延迟超过了5秒。在上面的示例中，我们使用`EXPIRE`来设置到期时间（它也可以用于对已经具有到期时间的键设置不同的到期时间，就像`PERSIST`可以用于移除到期时间并使键永久持久一样）。然而，我们也可以使用其他Redis命令创建具有到期时间的键。例如使用`SET`选项：

    > set key 100 ex 10
    OK
    > ttl key
    (integer) 9

上面的示例将一个具有字符串值`100`的键设置为十秒过期。然后调用`TTL`命令以检查键的剩余存活时间。

为了设置和检查以毫秒为单位的过期时间，请检查`PEXPIRE`和`PTTL`命令，以及`SET`选项的完整列表。

## 导航键空间

### 扫描
为了以高效的方式逐步迭代遍历 Redis 数据库中的键，您可以使用 `SCAN` 命令。

由于“SCAN”允许逐步迭代，每次调用仅返回少量元素，因此可以在生产中使用，而不会像“KEYS”或“SMEMBERS”等命令那样可能导致服务器在针对大量键或元素进行调用时被阻塞很长时间（甚至几秒钟）。

然而，尽管阻止诸如`SMEMBERS`之类的命令能够提供给定时刻集合中的所有元素，但`SCAN`系列命令仅对返回的元素提供有限的保证，因为在迭代过程中，我们逐步迭代的集合可能会发生变化。

### 键

另一种遍历键空间的方法是使用“KEYS”命令，但是这种方法应该谨慎使用，因为“KEYS”命令会阻塞Redis服务器直到所有键都被返回。

**警告**：将`KEYS`命令仅限在生产环境中非常谨慎地使用。

当针对大型数据库执行时，`KEYS`可能会破坏性能。
该命令旨在用于调试和特殊操作，例如更改键空间布局。
不要在常规应用程序代码中使用`KEYS`。
如果你想要在键空间的子集中查找键的方法，考虑使用`SCAN`或者[sets][tdts]。

[tdts]: /topics/data-types#sets

支持的通配符样式：

* `h?llo` 匹配 `hello`、`hallo` 和 `hxllo`
* `h*llo` 匹配 `hllo` 和 `heeeello`
* `h[ae]llo` 匹配 `hello` 和 `hallo`，但不匹配 `hillo`
* `h[^e]llo` 匹配 `hallo`、`hbllo`，但不匹配 `hello`
* `h[a-b]llo` 匹配 `hallo` 和 `hbllo`

如果您希望与特殊字符完全匹配，请使用`\`进行转义。
