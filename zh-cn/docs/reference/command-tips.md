---
title: "Redis 命令提示信息"
linkTitle: "命令提示信息"
weight: 1
description: 获取有关命令的其他信息
aliases:
    - /topics/command-tips
---

命令提示是一个字符串数组。
这些提供给Redis客户端关于命令的额外信息。
这些信息可以指示Redis集群客户端如何在集群部署中执行命令以及处理其输出。

不同于命令的标志（请参阅“COMMAND”的回复的第三个元素），标志严格限制于服务器的内部操作，而提示除了向客户端报告之外没有任何其他作用。

命令提示是任意字符串。
然而，下面的部分描述了建议的提示，并展示了它们可能遵循的约定。

## 非确定性输出

这个提示表示命令的输出是不确定的。
这意味着使用相同的参数和数据调用命令可能会得到不同的结果。
这种差异可能是命令的随机性导致的（例如`RANDOMKEY`和`SPOP`）；也可能是调用的时间差异（例如`TTL`）或者与服务器状态有关的通用差异（例如`INFO`和`CLIENT LIST`）。

**注意：**
在Redis 7.0之前，此提示是_random_命令标记。

## 非确定性输出顺序

存在这个提示的意味着命令的输出是确定性的，但是其顺序是随机的（例如，`HGETALL`和`SMEMBERS`）。

**注：**
在 Redis 7.0 之前，这个提示是 _sort_\__for_\__script_ 标志。

## 请求政策

这个提示可以帮助客户确定在集群模式下发送命令的分片。
如果客户没有实现_request_policy_提示的命令的默认行为如下：

1. 这个命令不接受关键字参数：客户端可以在任意分片上执行该命令。
1. 对于接受一个或多个关键字参数的命令：客户端应该将命令路由到单个分片，由输入键的哈希槽确定。

在客户端应采用与默认行为不同的情况下，_request_policy_ 提示可以是以下之一：

- **all_nodes：**客户端应在所有节点上执行命令-主节点和副本节点都是如此。
 一个例子是`CONFIG SET`命令。
 此提示用于不接受键名称参数的命令。
 该命令在每个分片上以原子方式操作。
* **all_shards：**客户端应在所有主分片上执行该命令（例如，`DBSIZE`命令）。
 此提示用于不接受键名称参数的命令。
 该命令在每个分片上以原子方式操作。
- **multi_shard：**客户端应在几个分片上执行命令。
 执行命令的分片由其输入键名称参数的哈希槽确定。
 这样的命令示例包括`MSET`，`MGET`和`DEL`。
 但请注意，`SUNIONSTORE`不被视为_multi_shard_，因为其所有键必须属于同一个哈希槽。
- **special：**表示客户端请求策略的非平凡形式，例如`SCAN`命令。

## 响应策略

这个提示可以帮助客户确定他们需要从集群中多个分片的回复中计算出的聚合结果。
对于没有_request_policy_提示的命令，默认行为仅适用于嵌套类型的回复（即，数组、集合或映射）。
客户端对于默认行为的实现应该如下所示：

1. 该命令不接受键名参数：客户端可以将所有回复聚合在一个嵌套的数据结构中。
例如，我们从对所有分片调用`KEYS`命令获得的数组回复。
这些回复应该无特定顺序地打包在一个单一的中。
2. 对于接受一个或多个键名参数的命令：客户端需要保持与输入键名相同的顺序进行回复。
例如，`MGET`命令的聚合回复。

为回复标量数据类型的命令设置_response_policy_提示，或者在期望客户端实现非默认聚合时使用。
此提示可以是以下之一：

* **one_succeeded:** 如果至少有一个分片没有返回错误，则客户端应返回成功。客户端应该回复它获得的第一个非错误回复。如果所有分片都返回错误，则客户端可以回复其中任何一个。例如，考虑一个发送给所有分片的 `SCRIPT KILL` 命令。尽管脚本应该在集群的所有分片上加载，但 `SCRIPT KILL` 通常只在给定时间内的一个分片上运行。
* **all_succeeded:** 只有当没有错误回复时，客户端才应返回成功。即使有一个错误回复，也应使聚合失效并返回。否则，客户端应返回一个非错误回复。例如，考虑 `CONFIG SET`、`SCRIPT FLUSH` 和 `SCRIPT LOAD` 命令。
* **agg_logical_and:** 客户端应返回对所有回复进行逻辑 "与" 操作的结果（仅适用于整数回复，通常来自返回 _0_ 或 _1_ 的命令） 。以 `SCRIPT EXISTS` 命令为例。它返回表示其给定的 SHA1 摘要在脚本缓存中是否存在的 _0_ 和 _1_ 数组。聚合响应只有当所有分片都报告给定脚本 SHA1 摘要存在于各自的缓存中时，才应为 _1_ 。
* **agg_logical_or:** 客户端应返回对所有回复进行逻辑 "或" 操作的结果（仅适用于整数回复，通常来自返回 _0_ 或 _1_ 的命令）。
* **agg_min:** 客户端应返回回复中的最小值（仅适用于数值回复）。例如，集群范围内 `WAIT` 命令的聚合回复应该是来自所有分片的最小值（同步副本数量）。
* **agg_max:** 客户端应返回回复中的最大值（仅适用于数值回复）。
* **agg_sum:** 客户端应返回回复的总和（仅适用于数值回复）。示例：`DBSIZE`。
* **special:** 这种类型的提示表示一个非平凡的回复策略。`INFO` 就是一个很好的例子。

## 示例

```
redis> command info ping
1)  1) "ping"
    2) (integer) -1
    3) 1) fast
    4) (integer) 0
    5) (integer) 0
    6) (integer) 0
    7) 1) @fast
       2) @connection
    8) 1) "request_policy:all_shards"
       2) "response_policy:all_succeeded"
    9) (empty array)
   10) (empty array)
```
