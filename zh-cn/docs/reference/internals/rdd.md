---
title: "Redis设计草案＃2（历史）"
linkTitle: "Redis 设计草案"
weight: 2
description: Redis早期编写的RDB格式设计。
aliases:
  - /topics/rdd
  - /topics/rdd-1
  - /topics/rdd-2
---

**注：此文档是Redis的创建者Salvatore Sanfilippo在Redis早期开发阶段（约2013年）撰写的一系列设计草案之一。出于历史兴趣的考虑，我们将其保留。**

# Redis 设计草案 2 -- RDB 版本 7 信息字段

* 作者: Salvatore Sanfilippo `antirez@gmail.com`
* GitHub问题[#1048](https://github.com/redis/redis/issues/1048)

## 修订历史

1.0，2013年4月10日 - 初稿。

## 概述

Redis RDB格式缺乏一种简单的方式来向RDB文件添加信息字段，即使不需要从RDB文件加载数据，也不会引起向后兼容性问题。

例如，感谢此文档中指定的信息字段，可以将文件创建时间、生成文件的Redis版本和其他任何有用的信息添加到RDB中，以确保正确处理RDB版本7文件时不需要每个字段。

同时，只需进行最小的更改，就可以在Redis 2.6中添加对RDB版本7的支持，而无需实际支持额外的字段，只需在加载RDB文件时跳过它们即可。

RDB信息字段可以根据需要具有语义含义，以便该字段的存在可以为RDB文件格式中指定的数据集添加信息。但是，当需要正确解码信息字段以了解和加载RDB文件的数据集内容时，必须增加RDB文件格式，以便Redis的先前版本不会尝试加载它。

然而目前，信息字段的设计仅用于存储与数据集加载无关的附加信息，但可以更好地指定RDB文件的创建方式。

## 信息字段表示

RDB格式6具有以下布局：

* 9个字节的魔术数字"REDIS0006"
* 键值对
* 一个EOF操作码
* CRC64校验和

提议将RDB格式7的可选字段添加在第9字节魔数之后，以便新格式将变成：

* 一个9字节的魔术数字"REDIS0007"
* 信息字段1
* 信息字段2
* ...
* 信息字段N
* 信息字段的结束
* 键值对
* 一个EOF操作码
* CRC64校验和

每个信息字段都具有以下结构：

* 一个16位标识符
* 一个64位数据长度
* 一个与指定长度完全相同的数据部分

标识符和数据长度都以小端字节顺序存储。

特殊标识符0表示没有其他信息字段，剩余的RDB文件包含键值对。

信息字段的处理方式

一个程序可以简单地跳过它不理解的每个信息字段，只要RDB版本与其能够加载的版本匹配即可。

## 信息字段ID和内容的规格说明。

### 信息字段 0 -- 信息字段结束

这只是意味着不再有要处理的信息字段。

### 信息字段 1 -- 创建日期

这个字段表示了RDB文件创建时的Unix时间。
Unix时间的格式是一个64位的小端整数，表示自1970年1月1日以来的秒数。

### 信息字段2 -- Redis版本

这个字段表示一个以null结尾的字符串，包含了生成文件的Redis版本，就像在Redis版本INFO字段中显示的那样。
