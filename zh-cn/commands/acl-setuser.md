在现有用户ACL规则的基础上创建一个ACL用户，或修改现有用户的规则。

以交互方式操作Redis的ACL用户。
如果用户名不存在，则该命令创建没有任何权限的用户名。
然后从左到右读取提供的连续参数中的所有规则，根据指定的用户ACL规则进行设置。
如果用户已经存在，提供的ACL规则将被简单地应用
*除了*已经设置的规则之外。例如：

    ACL SETUSER virginia on allkeys +set

以上命令创建了一个名为`virginia`的用户，此用户为活动状态（_on_规则），可以访问任何键（_allkeys_规则），并且可以调用set命令（_+set_规则）。
然后，您可以使用另一个`ACL SETUSER`调用来修改用户规则：

    ACL SETUSER virginia +get

上述规则将新规则应用于用户 `virginia`，因此除了 `SET`，用户 `virginia` 现在还可以使用 `GET` 命令。

从Redis 7.0开始，ACL规则也可以分为多个不同的规则集，称为“selectors”。
通过将规则放入括号中，并像其他规则一样提供它们来添加selectors。
为了执行命令，必须匹配给定命令的根权限（在括号外定义的规则）或任何一个selectors（在括号内定义的规则）。
例如：

    ACL SETUSER virginia on +GET allkeys (+SET ~app1*)

这将为用户设置两组权限，一组在用户上定义，另一组在选择器上定义。
root用户的权限仅允许执行get命令，但可以在任何键上执行该命令。
然后，选择器授予一个次要的权限集合：允许执行SET命令在以`app1`开头的任何键上执行。
使用多个选择器可以根据访问的键不同来授予权限。

当我们想确保从零开始定义一个用户，而不关心它是否有之前定义的关联规则时，可以使用特殊规则“reset”作为第一条规则，以清除所有其他现有规则。

    ACL SETUSER antirez reset [... other rules ...]

重置用户后，其ACL规则将恢复为默认状态：未激活、无密码、无法执行任何命令或访问任何密钥或通道：

    > ACL SETUSER antirez reset
    +OK
    > ACL LIST
    1) "user antirez off -@all"

ACL规则可以是像"on"、"off"、"reset"、"allkeys"这样的词，或者是以特殊字符开头的特殊规则，后面跟着另一个字符串（中间没有空格），比如"+SET"。

以下文档是关于该命令功能的参考手册，然而我们的 [ACL 教程](/topics/acl) 可能更适合作为对 ACL 系统工作原理的入门介绍。

## ACL规则

**Redis ACL规则被分为两类：定义命令权限或命令规则，以及定义用户状态或用户管理规则。**
**以下是所有支持的Redis ACL规则列表：**

### 命令规则

* `~<pattern>`：将指定的键模式（类似于`KEYS`命令中的glob样式模式）添加到用户可访问的键模式列表中。这将授予对与模式匹配的键的读写权限。您可以为同一用户添加多个键模式。示例：`~objects:*`
* `%R~<pattern>`：（仅在Redis 7.0及更高版本中可用）添加指定的可读键模式。它的行为类似于常规键模式，但仅授予从匹配给定模式的键读取的权限。有关更多信息，请参见[key permissions](/topics/acl#key-permissions)。
* `%W~<pattern>`：（仅在Redis 7.0及更高版本中可用）添加指定的可写键模式。它的行为类似于常规键模式，但仅授予写入匹配给定模式的键的权限。有关更多信息，请参见[key permissions](/topics/acl#key-permissions)。
* `%RW~<pattern>`：（仅在Redis 7.0及更高版本中可用）`~<pattern>`的别名。
* `allkeys`：`~*`的别名，允许用户访问所有键。
* `resetkeys`：从用户可访问的键模式列表中删除所有键模式。
* `&<pattern>`：（仅在Redis 6.2及更高版本中可用）将指定的glob样式模式添加到用户可访问的发布/订阅频道模式列表中。您可以为同一用户添加多个频道模式。示例：`&chatroom:*`
* `allchannels`：`&*`的别名，允许用户访问所有发布/订阅频道。
* `resetchannels`：从用户可访问的发布/订阅频道模式列表中删除所有频道模式。
* `+<command>`：将命令添加到用户可以调用的命令列表中。可与`|`一起使用以允许子命令（例如"+config|get"）。
* `+@<category>`：将指定类别中的所有命令添加到用户可以执行的命令列表中。示例：`+@string`（添加所有字符串命令）。要查看类别列表，请使用`ACL CAT`命令。
* `+<command>|first-arg`：允许一个特定的命令的第一个参数，即使其他命令被禁用。仅支持没有子命令的命令，并且不能以负形式使用，例如-SELECT|1，只允许以"+"开头的增量形式。此功能已被弃用，并可能在将来被删除。
* `allcommands`：`+@all`的别名。将服务器中的所有命令（包括通过模块加载的*future commands*）添加到此用户可以执行的命令中。
* `-<command>`：从用户可以调用的命令列表中移除命令。从Redis 7.0开始，可以与`|`一起使用以阻止子命令（例如"-config|set"）。
* `-@<category>`：与`+@<category>`类似，但删除类别中的所有命令而不是添加它们。
* `nocommands`：`-@all`的别名。删除所有命令，用户将无法执行任何操作。

### 用户管理规则

* `on`：设置用户为活动状态，可以使用`AUTH <用户名> <密码>`进行身份验证。
* `off`：将用户设置为非活动状态，无法以此用户身份登录。请注意，如果已经有连接使用此用户进行了身份验证，并且将其禁用（设置为off），连接将继续正常工作。要终止旧连接，可以使用带有用户选项的`CLIENT KILL`。另一种方法是使用`ACL DELUSER`删除用户，这将导致所有作为已删除用户身份验证的连接断开。
* `nopass`：将用户设置为“无密码”用户。这意味着可以使用任何密码进行该用户的身份验证。默认情况下，将`default`特殊用户设置为“nopass”。`nopass`规则还将重置用户的所有配置密码。
* `>密码`：将指定的明文密码添加为哈希密码列表中的一个密码。每个用户可以有多个活动密码，因此密码轮换将更简单。指定的密码不会以明文形式存储在服务器内部。示例：`>mypassword`。
* `#<哈希密码>`：将指定的哈希密码添加到用户密码列表中。Redis哈希密码使用SHA256哈希，并转换为十六进制字符串。示例：`#c3ab8ff13720e8ad9047dd39466b3c8974e592c2fa383d4a3960714caef0c4f2`。
* `<密码`：与`>密码`类似，但是删除密码而不是添加密码。
* `!<哈希密码>`：与`#<哈希密码>`类似，但是删除密码而不是添加密码。
* `(<规则列表>)`：（从Redis 7.0开始可用）创建用于匹配规则的新选择器。选择器在用户权限之后进行评估，并根据定义顺序进行评估。如果命令与用户权限或任何选择器匹配，则允许执行。详细信息请参阅[selectors](/docs/management/security/acl#selectors)。
* `clearselectors`：（从Redis 7.0开始可用）删除用户附加的所有选择器。
* `reset`：从用户中删除任何权限。它们被设置为off，没有密码，无法执行任何命令，无法访问任何键。

```
> ACL SETUSER alan allkeys +@string +@set -SADD >alanpassword
+OK

> ACL SETUSER antirez heeyyyy
(error) ERR Error in ACL SETUSER modifier 'heeyyyy': Syntax error
```
