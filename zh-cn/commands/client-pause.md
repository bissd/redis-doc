`CLIENT PAUSE`是一个连接控制命令，能够暂停所有指定时间(以毫秒为单位)的Redis客户端。

这个命令执行以下操作：

* 在给定的模式下停止处理所有未完成的普通和发布/订阅客户端命令。但是与副本的交互将继续正常进行。请注意，客户端在尝试执行命令时正式暂停，因此服务器端不会为非活动客户端承担任何工作。
* 然而，它会尽快向调用者返回OK，因此`CLIENT PAUSE`命令执行本身不会被暂停。
* 当指定的时间经过后，所有客户端都将解除阻塞：这将触发在暂停期间积累在每个客户端查询缓冲区中的所有命令的处理。

客户端暂停目前支持两种模式：

* `ALL`：这是默认模式。所有客户端命令都被阻塞。
* `WRITE`：只有在尝试执行写入命令时才会阻止客户端。

对于`WRITE`模式，有一些命令具有特殊行为：

* `EVAL`/`EVALSHA`：将阻塞客户端执行所有脚本。
* `PUBLISH`：将阻塞客户端。
* `PFCOUNT`：将阻塞客户端。
* `WAIT`：确认信息将被延迟，因此此命令将显示被阻塞。

这个命令非常有用，因为它可以以一种可控的方式将客户端从一个Redis实例切换到另一个Redis实例。例如，在实例升级期间，系统管理员可以执行以下操作：

* 使用`CLIENT PAUSE`命令暂停客户端。
* 等待几秒钟，确保复制的副本已经处理了来自主节点的最新复制流。
* 将其中一个复制的副本升级为主节点。
* 重新配置客户端以与新的主节点连接。

自 Redis 6.2 版本起，客户端暂停的推荐模式是 `WRITE`。此模式将停止所有复制流量，可以使用 `CLIENT UNPAUSE` 命令中止，并且允许重新配置旧的主节点，而无需在故障切换后接受写入。这也是集群故障切换期间使用的模式。

在6.2版本之前，可以在MULTI/EXEC块中发送CLIENT PAUSE命令，并与INFO replication命令一起，以获取在客户端被阻塞时的当前主服务器偏移量。通过这种方式，可以等待在副本端达到特定偏移量，以确保所有复制流被处理完毕。

自从Redis 3.2.10 / 4.0.0以后，该命令还可以防止在客户端暂停时键被逐出或过期。这样数据集不仅在客户端无法写入的情况下保持静态，而且从内部操作的角度来看也是如此。

## 行为变化历史

- `>= 3.2.0`: 客户端暂停不仅阻止客户端暂停，还阻止键清理。
